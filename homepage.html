<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Find Your 2026 Senedd Constituency</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="favicon.svg" type="image/svg+xml" />
  <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --primary-color: #006473;
      --font: 'Public Sans', sans-serif;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: var(--font);
      background-color: #fff;
      color: #222;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      padding: 1rem 2rem 2rem 2rem;
    }

    /* NAVIGATION BAR */
    nav {
      background: var(--primary-color);
      width: 100%;
      max-width: 960px;
      box-shadow: none;
      border-radius: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1rem;
      position: sticky;
      top: 0;
      z-index: 10;
      color: white;
    }

    nav ul {
      list-style: none;
      display: flex;
      gap: 1.25rem;
      font-weight: 600;
      font-size: 1rem;
      color: white;
    }

    nav ul li a {
      color: white;
      text-decoration: none;
      transition: color 0.2s ease;
    }

    nav ul li a:hover,
    nav ul li a:focus {
      color: #a1d3d9;
      outline: none;
    }

    /* Logo placeholder */
    .logo {
      font-weight: 700;
      font-size: 1.2rem;
      color: white;
      user-select: none;
      margin-right: 1rem;
      flex-shrink: 0;
    }

    /* Search widget */
    .search-widget {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      min-width: 280px;
      color: black;
    }

    .search-widget input[type="text"] {
      flex-grow: 1;
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      border: none;
      font-size: 1rem;
      font-family: var(--font);
      color: #222;
    }

    .search-widget input[type="text"]::placeholder {
      color: #777;
    }

    .search-widget button {
      background-color: white;
      border: none;
      color: var(--primary-color);
      font-weight: 600;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      transition: background-color 0.2s ease;
      flex-shrink: 0;
    }

    .search-widget button:hover,
    .search-widget button:focus {
      background-color: #d4f1f4;
      outline: none;
    }

    /* Current location button */
    .current-location-btn {
      background: transparent;
      border: none;
      cursor: pointer;
      padding: 0;
      margin-left: 0.3rem;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .current-location-btn svg {
      fill: var(--primary-color);
      width: 24px;
      height: 24px;
    }

    /* MAIN CONTAINERS */
    .container {
      width: 100%;
      max-width: none;
      background: transparent;
      border-radius: 0;
      box-shadow: none;
      padding: 1.5rem 1.5rem;
      margin-top: 1.5rem;
      text-align: right;
      color: var(--primary-color);
      font-weight: 600;
    }

    .container h2 {
      font-size: 1.4rem;
      margin-bottom: 0.75rem;
    }

    .container h3 {
      font-weight: 600;
      margin-bottom: 1rem;
      font-size: 1.2rem;
      color: #004e5a;
    }

    .container p {
      font-weight: 400;
      font-size: 1rem;
      line-height: 1.4;
      color: #222;
      max-width: 700px;
      margin-left: auto;
    }

    /* Responsive adjustments */
    @media (max-width: 480px) {
      nav ul {
        gap: 0.75rem;
        font-size: 0.9rem;
      }

      .search-widget {
        min-width: 200px;
      }

      .container {
        padding: 1rem 1rem;
        text-align: right;
      }

      .container h2 {
        font-size: 1.25rem;
      }

      .container h3 {
        font-size: 1.1rem;
      }

      body {
        padding: 1rem 1rem 2rem 1rem;
        align-items: flex-end;
      }
    }
  </style>
</head>
<body>

  <nav>
    <div class="logo" aria-label="Senedd logo">SeneddLogo</div>

    <ul>
      <li><a href="#">Latest News</a></li>
      <li><a href="#">Analysis</a></li>
      <li><a href="#">Constituencies</a></li>
      <li><a href="#">More</a></li>
    </ul>

    <form id="search-form" class="search-widget" role="search" aria-label="Search Senedd Constituency">
      <input type="text" id="postcode" name="postcode" placeholder="Enter postcode" aria-label="Postcode" required />
      <button type="submit" aria-label="Look up postcode">Look up</button>
      <button type="button" class="current-location-btn" title="Use current location" aria-label="Use current location">
        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <circle cx="12" cy="12" r="8" stroke="#006473" stroke-width="2" fill="none" />
          <circle cx="12" cy="12" r="4" fill="#006473" />
        </svg>
      </button>
    </form>
  </nav>

  <div class="container wales-decides-container" aria-live="polite">
    <h2>Wales Decides</h2>
    <p>
      Welcome to the 2026 Senedd Constituency lookup tool. This platform is designed to help you find detailed information about your Senedd constituency ahead of the upcoming elections. Simply enter your postcode above or use your current location to begin.
    </p>
  </div>

  <div class="container constituency-container" aria-live="polite">
    <h2>Your Constituency</h2>
    <h3 id="constituency-name">Please enter your postcode above</h3>
    <p id="constituency-info">
      Once you have searched, detailed information about your constituency will appear here, including representatives, recent election results, and key local issues.
    </p>
  </div>

  <div class="container news-videos-container">
    <h2>Latest News and Videos</h2>
    <p>
      Stay updated with the latest news, in-depth analysis, and video coverage focused on Welsh politics and your local constituency. Explore stories, interviews, and reports as the election approaches.
    </p>
  </div>

  <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>
  <script>
    const form = document.getElementById('search-form');
    const constituencyName = document.getElementById('constituency-name');
    const constituencyInfo = document.getElementById('constituency-info');
    const currentLocationBtn = document.querySelector('.current-location-btn');

    let boundaries = null;

    fetch('senedd2026.json')
      .then(res => res.json())
      .then(data => boundaries = data)
      .catch(() => {
        constituencyName.textContent = 'Error loading constituency data.';
        constituencyInfo.textContent = '';
      });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const postcode = document.getElementById('postcode').value.trim();

      if (!postcode) {
        constituencyName.textContent = 'Please enter a valid postcode.';
        constituencyInfo.textContent = '';
        return;
      }

      lookupConstituencyByPostcode(postcode);
    });

    currentLocationBtn.addEventListener('click', () => {
      constituencyName.textContent = 'Detecting location...';
      constituencyInfo.textContent = '';

      if (!navigator.geolocation) {
        constituencyName.textContent = 'Geolocation not supported by your browser.';
        return;
      }

      navigator.geolocation.getCurrentPosition(async (position) => {
        const { latitude, longitude } = position.coords;
        findConstituencyByCoords(longitude, latitude);
      }, () => {
        constituencyName.textContent = 'Unable to retrieve your location.';
      });
    });

    async function lookupConstituencyByPostcode(postcode) {
      constituencyName.textContent = 'Looking up constituency...';
      constituencyInfo.textContent = '';

      try {
        const res = await fetch(`https://api.postcodes.io/postcodes/${encodeURIComponent(postcode)}`);
        const data = await res.json();

        if (!data.result) throw new Error('Invalid postcode');

        if (data.result.country !== 'Wales') {
          constituencyName.textContent = 'This tool only supports Welsh postcodes.';
          constituencyInfo.textContent = '';
          return;
        }

        findConstituencyByCoords(data.result.longitude, data.result.latitude);
      } catch (err) {
        constituencyName.textContent = 'Error looking up postcode. Please try again.';
        constituencyInfo.textContent = '';
      }
    }

    function findConstituencyByCoords(longitude, latitude) {
      if (!boundaries) {
        constituencyName.textContent = 'Constituency data not loaded.';
        return;
      }

      const userPoint = turf.point([longitude, latitude]);
      const match = boundaries.features.find(f => turf.booleanPointInPolygon(userPoint, f));

      if (match) {
        const constituency = match.properties.enw_cymrae;
        constituencyName.textContent = constituency;
        constituencyInfo.innerHTML = `Your 2026 Senedd constituency is <strong>${constituency}</strong>. <a href="cons/${constituency.toLowerCase().replace(/\s+/g, '-').replace(/[^\w-]/g, '')}.html" style="color: var(--primary-color); text-decoration: underline;">More info</a>`;
      } else {
        constituencyName.textContent = 'Could not find your constituency.';
        constituencyInfo.textContent = '';
      }
    }
  </script>
</body>
</html>
